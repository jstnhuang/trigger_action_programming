<!-- import polymer-element's definition -->
<link rel="import" href="packages/polymer/polymer.html">
<link rel="import" href="packages/core_elements/core_collapse.html">
<link rel="import" href="packages/paper_elements/paper_button.html">
<link rel="import" href="packages/paper_elements/paper_shadow.html">
<link rel="import" href="action.html">
<link rel="import" href="trigger.html">

<polymer-element name="statement-card">
  <template>
    <style>
      .wrapper {
        margin-bottom: 20px;
      }
      .card {
        padding: 20px;
        background: white;
        box-sizing: border-box;
        width: 100%;
        border-radius: 2px;
        overflow: auto;
      }
      .ifthenheading {
        font-size: 1.5em;
        font-weight: normal;
        margin-top: 0px;
        display: inline;
      }
      .if-then-section + .if-then-section {
        margin-top: 20px;
      }
      paper-button {
        color: #fff;
        background-color: #01579B;
        text-transform: none;
      }
      paper-button + paper-button {
        margin-left: 10px;
      }
      #deleteButton {
        background-color: #B71C1C; 
      }
      .buttons {
        margin-top: 20px;
      }
      .uncreated-trigger a {
        color: #03A9F4;
        text-decoration: none;
        cursor: pointer;
      }
      .uncreated-trigger a:hover {
        text-decoration: underline;
      }
      .uncreated-trigger {
        margin-top: 10px;
      }
    </style>
    <div class="wrapper">
      <paper-shadow z="1">
        <core-collapse opened="{{opened}}" duration="0.3">
          <div class="card">
            <div class="if-then-section">
              <h1 class="ifthenheading">If: </h1>
              <template repeat="{{trigger in triggers | enumerate}}">
                <span on-delete-trigger="{{deleteTrigger}}" data-index="{{trigger.index}}">
                  <trigger-selector model="{{trigger.value}}" isFirst="{{trigger.index == 0}}" isOnly="{{triggers.length == 1}}" readOnly="{{readOnly}}"></trigger-selector>
                </span>
              </template>
              <template if="{{triggers.length > 0 && !readOnly}}">
                <div class="uncreated-trigger">
                  <a on-click="{{createTrigger}}">+ Add another condition</a>
                </div>
              </template>
            </div>
            <div class="if-then-section">
              <h1 class="ifthenheading">Then: </h1>
              <action-selector name="{{model.action_name}}" params="{{model.action_params}}" readOnly="{{readOnly}}"></action-selector>
            </div>
            <div class="buttons">
              <template if="{{!webstudy && !readOnly}}">
                <paper-button id="saveButton" disabled?="{{triggers.length == 0 || model.action_name == ''}}" on-click="{{save}}">{{saveLabel}}</paper-button>
              </template>
              <template if="{{!readOnly}}">
                <paper-button id="deleteButton" on-click="{{delete}}">{{deleteLabel}}</paper-button>
              </template>
            </div>
          </div>
        </core-collapse>
      </paper-shadow>
    </div>
  </template>
  <script type="application/dart" src="statement.dart"></script>
</polymer-element>
