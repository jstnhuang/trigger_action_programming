<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../../bower_components/core-animated-pages/transitions/slide-up.html">
<link rel="import" href="../../bower_components/core-collapse/core-collapse.html">
<link rel="import" href="../trigger-chooser/trigger-chooser.html">
<link rel="import" href="../daily-time-trigger/daily-time-trigger.html">

<polymer-element name="rule-card" attributes="triggers action mode">
  <template>
    <link rel="stylesheet" href="rule-card.css">
    <link rel="stylesheet" href="../creator.css">
    <template if="{{mode == 'update'}}">
      <core-collapse id="updateCollapse">
        <div id="update">
          <span class="preview">If <a class="changeable" on-click="{{chooseTrigger}}">this</a> then that</span>
        </div>
        <core-collapse id="chooseTrigger">
          <trigger-chooser on-trigger-selected="{{customizeTrigger}}"></trigger-chooser>
        </core-collapse>
        <core-collapse id="triggerOptions">
          <template if="{{selectedTrigger == 'daily_time'}}">
            <daily-time-trigger></daily-time-trigger>
          </template>
        </core-collapse>
      </core-collapse>
    </template>
    <template if="{{mode == 'summary'}}">
      <div class="ruleDesc">
        <template repeat="{{trigger, index in triggers}}">
          <span class="ifThenSection">
            <template if="{{index == 0}}">
              If
            </template>
            <template if="{{index != 0}}">
              and
            </template>
            <span class="taChip">{{trigger}}</span>
          </span>
        </template>
        <span class="ifThenSection">
          then <span class="taChip">{{action}}</span>
        </span>
      </div>
    </template>
  </template>
  <script>
    (function () {
      Polymer({
        mode: 'summary',
        selectedTrigger: '',
        ready: function() {
        },
        modeChanged: function() {
          this.async(function() {
            this.$.updateCollapse.toggle();
          }, null, 50);
        },
        chooseTrigger: function() {
          this.async(function() {
            this.$.chooseTrigger.toggle();
          }, null, 50);
        },
        customizeTrigger: function(e, detail) {
          this.selectedTrigger = detail;
          this.async(function() {
            this.$.triggerOptions.toggle();
          }, null, 50);
        }
      });
    })();
  </script>
</polymer-element>
