<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-shadow/paper-shadow.html">

<polymer-element name="rule-list" attributes="rules readOnly">
  <template>
    <link rel="stylesheet" href="rule-list.css">
    <paper-shadow class="listContainer">
      <template if="{{ rules.length == 0 }}">
        <p class="noRules">No rules have been created yet.</p>
      </template>
      <template repeat="{{ rule, index in rules }}">
        <template if="{{rule.mode == 'update' || rule.mode == 'create'}}">
          <paper-shadow z="2">
          <rule-card mode="{{rule.mode}}" triggers="{{rule.triggers}}" action="{{rule.action}}" name="{{rule.name}}" on-delete-rule="{{deleteRule}}" readOnly="{{readOnly}}"></rule-card>
          </paper-shadow>
        </template>
        <template if="{{rule.mode != 'update' && rule.mode != 'create'}}">
          <rule-card class="summary" index="{{index}}" mode="{{rule.mode}}" triggers="{{rule.triggers}}" action="{{rule.action}}" name="{{rule.name}}" on-click="{{updateRule}}" readOnly="{{readOnly}}" title="Click to edit this rule"></rule-card>
        </template>
      </template>
    </paper-shadow>
  </template>
  <script>
    (function () {
      Polymer({
        ready: function () {
        },
        newRule: function() {
          var newRule = {
            triggers: [{}],
            action: {},
            name: '',
            mode: 'create'
          };
          this.rules.unshift(newRule);
        },
        deleteRule: function(e, detail, sender) {
          this.rules.splice(detail.index, 1);
        },
        updateRule: function(e, detail, sender) {
          sender.mode = 'update';
        }
      });
    })();
  </script>
</polymer-element>
